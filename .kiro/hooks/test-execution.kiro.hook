{
  "enabled": true,
  "name": "Test Execution",
  "description": "Run relevant tests based on code changes to catch regressions early",
  "version": "1",
  "when": {
    "type": "fileEdited",
    "patterns": [
      "**/*.ts",
      "**/*.js",
      "**/*.tsx",
      "**/*.jsx",
      "**/package.json"
    ]
  },
  "then": {
    "type": "askAgent",
    "prompt": "Execute comprehensive testing based on recent code changes to ensure quality and catch regressions before they reach production.\n\n## Test Strategy\n\n**Analyze Changes:**\n- What files have been modified?\n- What components are affected by the changes?\n- What integration points might be impacted?\n- What performance-critical code has changed?\n\n**Test Selection:**\n- Unit tests for directly modified files\n- Integration tests for affected component interactions\n- Performance tests if performance-critical code changed\n- End-to-end tests for CLI functionality changes\n- Context7 integration tests if context management changed\n\n## Test Execution Commands\n\n**Unit Tests:**\n```bash\nnpm run test -- --changed\nnpm run test -- --coverage\n```\n\n**Integration Tests:**\n```bash\nnpm run test:integration\n```\n\n**Performance Tests:**\n```bash\nnpm run test:performance\n```\n\n**CLI Tests:**\n```bash\nnpm run test:cli\n```\n\n## Performance Validation Targets\n\n**CLI Response Time:**\n- Target: <100ms for CLI commands\n- Measure actual response times\n- Identify any regressions\n\n**Context Operations:**\n- Target: <500ms cached, <3s fresh lookup\n- Test caching effectiveness\n- Validate fallback mechanisms\n\n**Memory Usage:**\n- Target: <1GB baseline, <2GB with full context\n- Monitor memory consumption\n- Check for memory leaks\n\n## Required Output\n\n### Test Results Summary:\n- **Unit Tests**: [X passed, Y failed] - Coverage: [Z%]\n- **Integration Tests**: [X passed, Y failed]\n- **Performance Tests**: [X passed, Y failed]\n- **CLI Tests**: [X passed, Y failed]\n\n### Performance Metrics:\n- **CLI Response Time**: [Xms] (target: <100ms)\n- **Context Cached**: [Xms] (target: <500ms)\n- **Context Fresh**: [Xms] (target: <3s)\n- **Memory Usage**: [XMB] (target: <1GB baseline)\n\n### Issues Found:\n- **Test Failures**: [List failed tests with details]\n- **Performance Regressions**: [Any performance issues]\n- **Coverage Gaps**: [Areas needing more test coverage]\n\n### Validation Status:\n- [ ] All tests passing\n- [ ] Coverage targets met (>80%)\n- [ ] Performance targets met\n- [ ] No regressions detected\n- [ ] Ready for merge/deployment\n\nOnly proceed if all critical tests pass and performance targets are met."
  }
}